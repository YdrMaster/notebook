# 加速硬件分析

目前，我已经见到很多种加速硬件：SIMD 指令、DSP、NPU、TPU、GPU。尝试总结它们的具有不同的功能和用法：

1. SIMD 指令是特殊的 CPU 指令集，利用预留在 CPU 里的特殊电路，在固定周期同时对多个数据执行相同的计算，计算期间整个 CPU 是“忙”状态，虽然这个计算可能没有用到 CPU 的基本功能部分电路。
   > 实际上每个指令都只会用到 CPU 的一小部分，CPU 的复杂性来自于支持的指令数量。

2. 经典的 DSP 为 CPU 缺乏浮点处理能力的系统提供硬件、固定周期的基本浮点运算，包括两个浮点数的加减乘除余，一个浮点数的取相反数等。硬件厂商可能会提供 DSP 运算库，针对自己的 DSP 特殊性，实现尽量快的通用算法，比如矩阵运算、FFT 等。现代的 DSP，可能会把一部分计算库也做到硬件里，使得执行整个的复杂运算得到某种程度的加速，这样不用改动 DSP 运算库（就意味着不用改动依赖计算库的应用程序）就能获得加速效果。DSP 运算期间，CPU 的状态是平台特定的，可能是忙状态，也可能只把 DSP 当作 IO 设备。也有许多现代 CPU 内置 DSP，通过扩展指令集暴露 DSP 的功能。

3. NPU、TPU、GPU 通常是独立的设备，但与独立 DSP 的不同之处在于它们有 CPU 级别的功能（通常描述为“比 CPU 简单得多”，但和 CPU 仍可比，比如有取指、译码、执行、写回时序，至少是一部分）。之所以它们需要复杂的功能，是因为它们执行的计算任务更加复杂，不能仅靠一次输入的数据和单独的操作码描述，必须有一定的软件参与进来（微程序）。因此它们需要自己的编译器，使用时需要同时输入微程序和参数。由于传参返回更复杂，计算也更耗时（通常描述为比 CPU 快 X 倍，而不是 X 个周期），所以计算期间 CPU 不可能忙等，必须调度出去，所以必须提供中断来报告计算完成。另外由于计算的复杂性，这类硬件通常不能内置足够的内存保存参数、中间过程和返回值，而需要借用整个系统的内存，因此它必须有 DMA。

按这个分类标准认识新硬件，或许可以简化理解难度。
